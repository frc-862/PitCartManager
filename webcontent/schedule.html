<head>
    <link rel="stylesheet" href="style.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="socket.io.js"></script>
    <script type="text/javascript" src="js/notifMgmt.js"></script>
    <script type="text/javascript" src="js/pitSocket.js"></script>
    <script type="text/javascript" src="js/lock.js"></script>
</head>
<body style="text-align: center;padding:16px;overflow-y:hidden">
    <div id="section_main">
        <div class="backgroundanim" style="position: absolute;z-index:3;top:0;left:0;width:100%;height:100%;transition:all 0.5s ease-in-out;" id="lockScreen">
            <div style="position: absolute;top:50%;left:10%;transform:translateY(-50%);">
                
                <div class="innercontainer constantturnanim" style="width:60vh;height:60vh;border-radius:60vh;transition:0.5s all ease-in-out;float:left" id="unlock">
                    <img src="images/CRESCENDO_transparent.png" style="width: 96%;margin-top:27%;pointer-events:none"/>
                </div>
                <div style="margin-left:20px;height:60vh;float:left;text-align:center">
                    <span class="basetext" style="font-size:5vw;pointer-events:none;font-weight:600;margin-left:40px;line-height:60vh;display:inline-block">Good Luck!</span>
                    
                </div>
                
            </div>
            
        </div>

        <div class="dvd" style="display:none;position: absolute;z-index:5;top:0;left:0;width:100%;height:100%;transition:all 0.5s ease-in-out;" id="dvd">
            <img src="images/password/john2.jpg" width="212" height="212" id="dvdImage"/>
        </div>

        <div class="container" style="display:none">
            <div style="display: flex;justify-content:space-around;margin-top:30px">
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Match</span>
                        <div class="innercontainer" style="width:80px;height:80px;display:block;text-align:center">
                            <span class="basetext" style="font-size:60px;font-weight:600">20</span>
                        </div>
                    </div>
                   
                </div>
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Bumpers</span>
                        <div class="innercontainer red" style="width:160px;height:80px;display:block;text-align:center">
                            <span class="basetext" style="font-size:60px;font-weight:600">Red</span>
                        </div>
                    </div>
                   
                </div>
            </div>
            <div style="display: flex;justify-content:center;margin-top:40px;margin-bottom:30px">
                <div style="display:inline-flex">
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">254</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer blue" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">862</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">1023</span>
                        </div>
                        
                    </div>
                    <div style="border-left:2px solid white;height:45px;margin:5px;margin-top:5px;border-radius:2px"></div>
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">33</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">118</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">494</span>
                        </div>
                        
                    </div>
                   
                </div>
                
            </div>

        </div>
        <div id="maindata" class="container">
            <div style="display: flex;justify-content:space-around;margin-top:10px;margin-bottom:10px">
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Matches Played</span>
                        <div class="innercontainer" style="width:200px;height:60px;display:block;text-align:center">
                            <span class="basetext" style="font-size:50px;font-weight:600" id="matchesPlayed">20 <span style="opacity:0.6">/ 76</span></span>
                        </div>
                    </div>
                   
                </div>
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Wins / Losses / Ties</span>
                        <div class="innercontainer" style="width:260px;height:60px;display:block;text-align:center">
                            <span class="basetext" style="font-size:50px;font-weight:600" id="record">1-1-0</span>
                        </div>
                    </div>
                   
                </div>
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Our Next Match</span>
                        <div class="innercontainer red" style="width:160px;height:60px;display:block;text-align:center" id="nextMatch">
                            <span class="basetext" id="nextMatchNum" style="font-size:32px;font-weight:600;display:block">21</span>
                            <span class="basetext" id="nextMatchTime" style="font-size:14px;font-weight:600;display:block">in 5 minutes</span>
                        </div>
                    </div>
                   
                </div>
            </div>
        </div>

        <div style="display: block;text-align:left">
            <div id="additionalMatches" style="max-height: 74%;overflow-y:scroll;transition:0.5s all ease-in-out;width:50%;padding-bottom:20px;float:left">
            
                <div class="container" id="trackMatchContainer">
                    <div style="display: table;">
                        <div style="display: table-cell;vertical-align: middle;width:25%;text-align:left">
                            <span class="basetext" style="font-size: 20px;font-weight:600;margin-left:20px">Match 21</span>
                        </div>
                        <div style="display: table-cell;vertical-align: middle;text-align:right;width:20%;text-align:left">
                            <div class="innercontainer success" style="width:50px;height:20px;display:inline-block;text-align:center;margin:5px;padding:10px;border-radius:24px">
                                <span class="basetext" style="font-size:14px;font-weight:600">WIN</span>
                            </div>
                        </div>
                        <div style="display: table-cell;vertical-align: middle;text-align:center;">
                            <div style="display: flex;text-align:center">
                                <div style="display:block">
                                    <div class="innercontainer bluedim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                        <span class="basetext" style="font-size:12px;font-weight:600">254</span>
                                    </div>
                                    
                                </div>
                                <div style="display:block">
                                    <div class="innercontainer blue" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                        <span class="basetext" style="font-size:12px;font-weight:600">862</span>
                                    </div>
                                    
                                </div>
                                <div style="display:block">
                                    <div class="innercontainer bluedim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                        <span class="basetext" style="font-size:12px;font-weight:600">1023</span>
                                    </div>
                                    
                                </div>
                                <div style="display:block">
                                    <div class="innercontainer reddim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                        <span class="basetext" style="font-size:12px;font-weight:600">33</span>
                                    </div>
                                    
                                </div>
                                <div style="display:block">
                                    <div class="innercontainer reddim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                        <span class="basetext" style="font-size:12px;font-weight:600">118</span>
                                    </div>
                                    
                                </div>
                                <div style="display:block">
                                    <div class="innercontainer reddim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                        <span class="basetext" style="font-size:12px;font-weight:600">494</span>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="extraSide" style="width: 44vw;float:left;margin-left:3vw;border-radius:20px;text-align:center;padding-top:10px">
                <div style="margin:40px 10px;text-align:center">
                    <div class="innercontainer" style="background-color:#323996;margin:10px;margin-bottom:40px;width:80%;display:inline-block">
                        <span class="basetext" style="font-size:5vw;font-weight:600" id="currentTime">--:--:--</span>
                        <span class="basetext" style="display:block;font-size:14px" id="lastUpdated"></span>
                    </div>
                    
                </div>
                
                <div class="extraPanel" data-panelnum="0">
                    <img src="images/CRESCENDO_transparent.png" style="width: 80%;pointer-events:none"/>
                </div>
                <div class="extraPanel" data-panelnum="1" style="display: none;">
                    
                </div>

            </div>
        </div>
        
        
    </div>
  

    
    <div class="notificationboxsmall innercontainer" id="notificationBox">
        <h1 class="basetext" id="notificationText">We are currently on the field</h1>
    </div>
    
    <script>
        var allMatches = [];
        var heightOfMatch = 0;
        var panelCounter = 0;
        var imagesEnabled = true;

        // setInterval(function(){
        //     panelCounter+=1;
        //     if(panelCounter > 1){
        //         panelCounter = 0;
        //     }
        //     if (imagesEnabled) {
        //         Array.from(document.getElementsByClassName("extraPanel")).forEach(function(panel){
        //             if((parseInt(panel.dataset.panelnum)) == panelCounter){
        //                 panel.style.display = "";
        //             }else{
        //                 panel.style.display = "none";
        //             }
        //         });
        //     }
        // }, 10000);

        socket.on('setting_scheduleView', function(setting, value){
            switch (setting){
                case "images":
                    imagesEnabled = value;
                    break;
                default:
                    break;
            }
        });

        heightOfMatch = document.getElementById("trackMatchContainer").offsetHeight + 30;

        socket.on("team", function(val){
            teamNum = parseInt(val);
            if(teamNum == undefined){
                showNotif("Currently Awaiting Setup...", "red");
            }else{
                socket.emit("getMatches");
                hideNotif();
            }
            updateLock();
        })
        var d = [];
        socket.on("matches", function(data){
            d = data;
            var matches = data["docs"];
            var currentMatch = undefined;
            

            lastUpdated = new Date();
            document.getElementById("additionalMatches").innerHTML = "";
            allMatches = matches;
            if (data.currentMatchType == "Playoff") {
                allMatches.sort((a,b) => {
                    if (a.n == a.playoffNum && a.api != "cloud") {
                        a.playoffNum += 913;
                    }
                    if (b.n == b.playoffNum && a.api != "cloud") {
                        b.playoffNum += 913;
                    }
                    return a.playoffNum-b.playoffNum;
                });
            } else {
                allMatches.sort((a,b) => a.n-b.n);
            }
            
            var played = 0;
            var total = 0;
            var matchOnField = undefined;
            var scrollToMatch = 0;
            var matchOnFieldN = data["currentMatch"];
            var wins = 0;
            var losses = 0;
            var ties = 0;
            allMatches.forEach(match => {

                if(matchOnField == undefined && match["n"] == matchOnFieldN){
                    matchOnField = match;
                }

                if(currentMatch == undefined && match["status"] == "pending" && match["teams"].includes(teamNum)){
                    currentMatch = match;
                }
                
                    total++;
                    if(match["status"] != "pending"){
                        played++;
                    }
                    if(match["n"] <= currentMatch ){
                        scrollToMatch = total;
                    }
                    
                    if(match["n"] > 900) {
                        match["n"] = match["n"] - 900;
                    }
                    
                    var teamcolor = match.teams.indexOf(teamNum) > 2 ? "blue" : "red";
                    if (match.level == "Playoff") {
                        const matchMap = ["UB #1", "UB #2", "UB #3", "UB #4", "LB #5", "LB #6", "UB #7", "UB #8", "LB #9", "UB #10", "UB #11", "LB #12", "LB #13", "F1", "F2", "F3"];
                        if (match.playoffNum != match.n) { match.playoffNum -= 901 }
                        var contenttoshow = matchMap[match.playoffNum];
                    } else {
                        var contenttoshow = "#" + match["n"];
                    }

                    if(match["status"] != "pending"){
                        if(match["winner"] == teamcolor){
                            wins++;
                        }else if(match["winner"] == "tie"){
                            ties++;
                        }else{
                            losses++;
                        }
                    }

                    
                    document.getElementById("additionalMatches").innerHTML += `<div class="container" style="padding:10px">
                        <div style="display: block;">
                            <div style="display: table-cell;vertical-align: middle;width:12%;text-align:left">
                                <span class="basetext" style="font-size: 20px;font-weight:600;margin-left:10px">${contenttoshow}</span>
                            </div>
                            
                            <div style="display: table-cell;vertical-align: middle;text-align:center;width:50%">
                                <div style="display: flex;text-align:center">
                                    <div style="display:block">
                                        <div style="display:inline-block">
                                            <div style="display:inline-block">
                                                <div class="innercontainer ${match["teams"][0] == teamNum ? "red" : "reddim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                                    <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][0]}</span>
                                                </div>
                                                
                                            </div>
                                            <div style="display:inline-block">
                                                <div class="innercontainer ${match["teams"][1] == teamNum ? "red" : "reddim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                                    <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][1]}</span>
                                                </div>
                                                
                                            </div>
                                            <div style="display:inline-block">
                                                <div class="innercontainer ${match["teams"][2] == teamNum ? "red" : "reddim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                                    <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][2]}</span>
                                                </div>
                                                
                                            </div>
                                        </div>
                                        <div style="display:inline-block">
                                            <div style="display:inline-block">
                                                <div class="innercontainer ${match["teams"][3] == teamNum ? "blue" : "bluedim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                                    <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][3]}</span>
                                                </div>
                                                
                                            </div>
                                            <div style="display:inline-block">
                                                <div class="innercontainer ${match["teams"][4] == teamNum ? "blue" : "bluedim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                                    <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][4]}</span>
                                                </div>
                                                
                                            </div>
                                            <div style="display:inline-block">
                                                <div class="innercontainer ${match["teams"][5] == teamNum ? "blue" : "bluedim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                                    <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][5]}</span>
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    
                                </div>
                            </div>
                            <div class="${match["status"] == "pending" ? "" : (match["winner"] == teamcolor ? "constantturnanim2" : "")}" style="display: table-cell;vertical-align: middle;text-align:right;width:20%;text-align:right;opacity:${match["status"] == "pending" ? "0.4" : "1"}">
                                <div class="innercontainer" style="width:70px;height:20px;display:inline-block;text-align:center;margin:5px;padding:10px;border-radius:24px;${match["status"] == "pending" ? "" : (match["winner"] == teamcolor ? "border:2px solid #1fcc87" : (match["winner"] == "tie" ? "border:2px solid #ffffff" : "border:2px solid #ff3636"))}">
                                    <span class="basetext" style="font-size:14px;font-weight:600;">${match["status"] == "pending" ? `...` : `${match["scores"][teamcolor == "red" ? 0 : 1]} - <span style="opacity:0.6">${match["scores"][teamcolor == "red" ? 1 : 0]}`}</span></span>
                                </div>
                            </div>
                        </div>
                    </div>`
                
            });
            document.getElementById("record").innerHTML = `${wins} - <span style="opacity:0.6">${losses} - ${ties}</span>`;
            document.getElementById("matchesPlayed").innerHTML = `${played} <span style="opacity:0.6">/ ${total}</span>`;
            if(currentMatch != undefined){
                document.getElementById("nextMatchNum").innerHTML = currentMatch["n"];
                document.getElementById("additionalMatches").scrollTo(0, (scrollToMatch-2) * heightOfMatch);
                document.getElementById("nextMatch").style.backgroundColor = currentMatch["teams"].indexOf(teamNum) <= 2 ? "#ff3636" : "#3679ff";
                if(matchOnField == undefined || matchOnField <= 0){
                    document.getElementById("nextMatchTime").innerHTML = "soon...";
                }else{
                    document.getElementById("nextMatchTime").innerHTML = "in " + (currentMatch["n"] - matchOnField["n"]) + " matches";
                }
            }else{
                document.getElementById("nextMatchNum").innerHTML = "NONE";
                document.getElementById("nextMatch").style.backgroundColor = "#003573";
                document.getElementById("nextMatchTime").innerHTML = ":D";
            }

            
            
        });

    </script>
    <script src="js/timeupdate.js"></script>
    
</body>