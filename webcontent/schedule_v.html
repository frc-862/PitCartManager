<head>
    <link rel="stylesheet" href="style.css"/>
</head>
<body style="text-align: center;padding:16px;overflow-y:hidden">
    <div id="section_main">
        <div class="backgroundanim" style="position: absolute;z-index:3;top:0;left:0;width:100%;height:100%;transition:all 0.5s ease-in-out;" id="lockScreen">
            <div style="position: absolute;top:20%;left:50%;transform:translateX(-50%);">
                <div class="innercontainer constantturnanim" style="width:60vw;height:60vw;border-radius:60vw;transition:0.5s all ease-in-out;margin-bottom:100px" id="unlock">
                    <img src="images/RapidReact.png" style="width: 100%;margin-top:10%;pointer-events:none"/>
                </div>
                <br/>
                <span class="basetext" style="font-size:80px;pointer-events:none;font-weight:600">Good Luck!</span>
            </div>
            
        </div>
        <div class="container" style="display:none">
            <div style="display: flex;justify-content:space-around;margin-top:30px">
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Match</span>
                        <div class="innercontainer" style="width:80px;height:80px;display:block;text-align:center">
                            <span class="basetext" style="font-size:60px;font-weight:600">20</span>
                        </div>
                    </div>
                   
                </div>
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Bumpers</span>
                        <div class="innercontainer red" style="width:160px;height:80px;display:block;text-align:center">
                            <span class="basetext" style="font-size:60px;font-weight:600">Red</span>
                        </div>
                    </div>
                   
                </div>
            </div>
            <div style="display: flex;justify-content:center;margin-top:40px;margin-bottom:30px">
                <div style="display:inline-flex">
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">254</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer blue" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">862</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">1023</span>
                        </div>
                        
                    </div>
                    <div style="border-left:2px solid white;height:45px;margin:5px;margin-top:5px;border-radius:2px"></div>
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">33</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">118</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">494</span>
                        </div>
                        
                    </div>
                   
                </div>
                
            </div>

        </div>
        <div id="maindata" class="container">
            <div style="display: flex;justify-content:space-around;margin-top:20px;margin-bottom:20px">
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Matches Played</span>
                        <div class="innercontainer" style="width:200px;height:60px;display:block;text-align:center">
                            <span class="basetext" style="font-size:50px;font-weight:600" id="matchesPlayed">20 <span style="opacity:0.6">/ 76</span></span>
                        </div>
                    </div>
                   
                </div>
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Our Next Match</span>
                        <div class="innercontainer red" style="width:160px;height:60px;display:block;text-align:center" id="nextMatch">
                            <span class="basetext" id="nextMatchNum" style="font-size:32px;font-weight:600;display:block">21</span>
                            <span class="basetext" id="nextMatchTime" style="font-size:14px;font-weight:600;display:block">in 5 minutes</span>
                        </div>
                    </div>
                   
                </div>
            </div>
        </div>
        <br/>
        <div id="additionalMatches" style="max-height: 70%;overflow-y:scroll;transition:0.5s all ease-in-out">
            
            <div class="container" id="trackMatchContainer">
                <div style="display: table;">
                    <div style="display: table-cell;vertical-align: middle;width:25%;text-align:left">
                        <span class="basetext" style="font-size: 20px;font-weight:600;margin-left:20px">Match 21</span>
                    </div>
                    <div style="display: table-cell;vertical-align: middle;text-align:right;width:20%;text-align:left">
                        <div class="innercontainer success" style="width:50px;height:20px;display:inline-block;text-align:center;margin:5px;padding:10px;border-radius:24px">
                            <span class="basetext" style="font-size:14px;font-weight:600">WIN</span>
                        </div>
                    </div>
                    <div style="display: table-cell;vertical-align: middle;text-align:center;">
                        <div style="display: flex;text-align:center">
                            <div style="display:block">
                                <div class="innercontainer bluedim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                    <span class="basetext" style="font-size:12px;font-weight:600">254</span>
                                </div>
                                
                            </div>
                            <div style="display:block">
                                <div class="innercontainer blue" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                    <span class="basetext" style="font-size:12px;font-weight:600">862</span>
                                </div>
                                
                            </div>
                            <div style="display:block">
                                <div class="innercontainer bluedim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                    <span class="basetext" style="font-size:12px;font-weight:600">1023</span>
                                </div>
                                
                            </div>
                            <div style="display:block">
                                <div class="innercontainer reddim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                    <span class="basetext" style="font-size:12px;font-weight:600">33</span>
                                </div>
                                
                            </div>
                            <div style="display:block">
                                <div class="innercontainer reddim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                    <span class="basetext" style="font-size:12px;font-weight:600">118</span>
                                </div>
                                
                            </div>
                            <div style="display:block">
                                <div class="innercontainer reddim" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                    <span class="basetext" style="font-size:12px;font-weight:600">494</span>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    <div class="notificationbox innercontainer" id="notificationBox">
        <h1 class="basetext" id="notificationText">We are currently on the field</h1>
    </div>

    <script src="socket.io.js"></script>
    <script>
        const socket = io("ws://localhost:3001", {
            cors: {
                origin: "http://localhost",
                methods: ["GET", "POST"]
              }
        });


        var notificationOut = false;
        var teamNum = undefined;
        var allMatches = [];
        var heightOfMatch = 0;
        heightOfMatch = document.getElementById("trackMatchContainer").offsetHeight + 5;
        var locked = false;
        socket.on('disconnect', function(){
            showNotif("Oops! We're Disconnected...", "reddim");
        });

        socket.on('connect', function(){
            hideNotif();
            
            console.log("Successfully connected to server");
            socket.emit("getTeam");
        });

        socket.on('notif_s', function(reason){
            
            if(reason == "practice"){
                showNotif("We are at the practice field", "reddim");
            }
            else if(reason == "match"){
                showNotif("We are on the field!", "reddim");
            }
            else if(reason == "strategy"){
                showNotif("We are with strategy", "reddim");
            }
            else if(reason == "lunch"){
                showNotif("We are at lunch!", "reddim");
            }
            else if(reason == "cancel"){
                hideNotif();
            }
            else {
                showNotif("We are somewhere else right now...", "reddim");
            }
            
        })

        socket.on("team", function(val){
            teamNum = val;
            if(teamNum == undefined){
                showNotif("Currently Awaiting Setup...", "red");
            }else{
                socket.emit("getMatches");
                hideNotif();
            }
            updateLock();
        })
        
        socket.on("matches", function(matches){
            document.getElementById("additionalMatches").innerHTML = "";
            allMatches = matches;
            allMatches.sort((a,b) => (a.n > b.n) ? 1 : ((b.n > a.n) ? -1 : 0))
            var played = 0;
            var total = 0;
            var currentMatch = undefined;
            allMatches.forEach(match => {

                if(match["teams"].includes(teamNum)){
                    total++;
                    if(match["status"] != "pending"){
                        played++;
                    }else if(currentMatch == undefined){
                        currentMatch = match;
                    }
                    var teamcolor = match.teams.indexOf(teamNum) > 2 ? "blue" : "red";
                    document.getElementById("additionalMatches").innerHTML += `<div class="container">
                        <div style="display: table;">
                            <div style="display: table-cell;vertical-align: middle;width:25%;text-align:left">
                                <span class="basetext" style="font-size: 20px;font-weight:600;margin-left:20px">Match ${match["n"]}</span>
                            </div>
                            <div style="display: table-cell;vertical-align: middle;text-align:right;width:20%;text-align:left">
                                <div class="innercontainer ${match["status"] == "pending" ? "TBD" : (match["winner"] == teamcolor ? "success" : "")}" style="width:50px;height:20px;display:inline-block;text-align:center;margin:5px;padding:10px;border-radius:24px">
                                    <span class="basetext" style="font-size:14px;font-weight:600">${match["status"] == "pending" ? "TBD" : (match["winner"] == teamcolor ? "WIN" : "LOSS")}</span>
                                </div>
                            </div>
                            <div style="display: table-cell;vertical-align: middle;text-align:center;">
                                <div style="display: flex;text-align:center">
                                    <div style="display:block">
                                        <div class="innercontainer ${match["teams"][0] == teamNum ? "red" : "reddim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                            <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][0]}</span>
                                        </div>
                                        
                                    </div>
                                    <div style="display:block">
                                        <div class="innercontainer ${match["teams"][1] == teamNum ? "red" : "reddim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                            <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][1]}</span>
                                        </div>
                                        
                                    </div>
                                    <div style="display:block">
                                        <div class="innercontainer ${match["teams"][2] == teamNum ? "red" : "reddim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                            <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][2]}</span>
                                        </div>
                                        
                                    </div>
                                    <div style="display:block">
                                        <div class="innercontainer ${match["teams"][3] == teamNum ? "blue" : "bluedim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                            <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][3]}</span>
                                        </div>
                                        
                                    </div>
                                    <div style="display:block">
                                        <div class="innercontainer ${match["teams"][4] == teamNum ? "blue" : "bluedim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                            <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][4]}</span>
                                        </div>
                                        
                                    </div>
                                    <div style="display:block">
                                        <div class="innercontainer ${match["teams"][5] == teamNum ? "blue" : "bluedim"}" style="width:34px;height:16px;display:block;text-align:center;margin:5px;padding:10px">
                                            <span class="basetext" style="font-size:12px;font-weight:600">${match["teams"][5]}</span>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`
                }
                
            });
            document.getElementById("matchesPlayed").innerHTML = `${played} <span style="opacity:0.6">/ ${total}</span>`;
            if(currentMatch != undefined){
                document.getElementById("nextMatchNum").innerHTML = currentMatch["n"];
                document.getElementById("additionalMatches").scrollTo(0, allMatches.indexOf(currentMatch) * heightOfMatch);
                document.getElementById("nextMatch").style.backgroundColor = currentMatch["teams"].indexOf(teamNum) <= 2 ? "#ff3636" : "#3679ff";
            }else{
                document.getElementById("nextMatchNum").innerHTML = "NONE";
                document.getElementById("nextMatch").style.backgroundColor = "";
                document.getElementById("nextMatchTime").innerHTML = ":D";
            }
            
        });


        function updateLock(){
            if(locked || teamNum == undefined){
                document.getElementById("lockScreen").style.display = "";
                setTimeout(function(){
                    document.getElementById("lockScreen").style.opacity = "1";
                }, 10);
                
            }else{
                document.getElementById("lockScreen").style.opacity = "0";
                setTimeout(function(){
                    document.getElementById("lockScreen").style.display = "none";
                }, 550);
            }
        }

        socket.on('lock', function(n){
            locked = n;
            if(teamNum != undefined){
                updateLock();
            }
            
        });



        function showNotif(content, color){
            if(notificationOut){
                hideNotif();
                setTimeout(function(){
                    notificationOut = false;
                    showNotif(content, color);
                }, 500);
                return;
            }
            if(color == "red"){
                document.getElementById("notificationBox").style.backgroundColor = "#ff3636";
            }else if(color == "reddim"){
                document.getElementById("notificationBox").style.backgroundColor = "#a12222";
            }else if(color == "blue"){
                document.getElementById("notificationBox").style.backgroundColor = "#3679ff";
            }else if(color == "bluedim"){
                document.getElementById("notificationBox").style.backgroundColor = "#2450a6";
            }else if(color == "success"){
                document.getElementById("notificationBox").style.backgroundColor = "#1fcc87";
            }else if(color == "successdim"){
                document.getElementById("notificationBox").style.backgroundColor = "#199e69";
            }
            else if(color == "default"){
                document.getElementById("notificationBox").style.backgroundColor = "#003573";
            }
            document.getElementById("notificationBox").style.bottom = "20px";
            document.getElementById("notificationText").innerHTML = content;
            notificationOut = true;
        }
        function hideNotif(){
            document.getElementById("notificationBox").style.bottom = "-200px";
            notificationOut = false;
        }

    </script>
    
</body>