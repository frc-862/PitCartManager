<head>
    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="icofont/icofont.min.css">
</head>
<body style="text-align: center;padding:16px;overflow-y:hidden">
    <div id="section_main">
        
        <div style="position: absolute;z-index:2;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);transition:all 0.5s ease-in-out;display:none;opacity:0" id="totalOverlay">
            <div class="container overlaybox" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;text-align:center;" data-purpose="finishMatch">
                <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px">Report Match 20's Status</span>
                <div style="display:inline-flex">
                    <div style="display:block">
                        <div class="innercontainer matchdataitem" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px;" data-category="status" data-value="win">
                            <span class="basetext" style="font-size:20px;font-weight:600;pointer-events:none">Win</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer matchdataitem"  style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px;" data-category="status" data-value="tie">
                            <span class="basetext" style="font-size:20px;font-weight:600;pointer-events:none">Tie</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer matchdataitem" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px;" data-category="status" data-value="loss">
                            <span class="basetext" style="font-size:20px;font-weight:600;pointer-events:none">Loss</span>
                        </div>
                        
                    </div>
                </div>
                <br/>
                <div style="display: inline-flex;margin-top:20px">
                    <div class="checkitem">
                        <div class="basebutton circlebutton matchdataitem" style="width:30px;height:30px;" data-category="rankingPoints" data-value="0">
                            <span class="basetext icofont-check" style="font-size:30px;font-weight:600;pointer-events:none;"></span>
                        </div>
                        <span class="basetext" style="font-size:28px;margin-left:10px">Climb Ranking Point</span>
                    </div>
                </div>
                <br/>
                <div style="display: inline-flex;margin-top:20px;margin-bottom:20px">
                    <div class="checkitem">
                        <div class="basebutton circlebutton matchdataitem" style="width:30px;height:30px;" data-category="rankingPoints" data-value="0">
                            <span class="basetext icofont-check" style="font-size:30px;font-weight:600;pointer-events:none;"></span>
                        </div>
                        <span class="basetext" style="font-size:28px;margin-left:10px">Cargo Ranking Point</span>
                    </div>
                </div>
                <br/>
                <div class="basebutton" style="width: 16%;margin-bottom:20px" id="submitMatch">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Submit</span>
                </div>
                
            </div>
            <div class="container overlaybox" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;text-align:center;" data-purpose="status">
                <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px">Set Status</span>
                <span class="basetext" style="font-size:20px;color:white;display:block;margin:8px">Deselect a field to reset status.</span>
                <br/>
                <div style="width:90%;display:inline-block;margin-bottom:20px">
                    <div class="basebutton notif" style="width: 20%;margin:5px" data-notif="practice">
                        <span class="basetext" style="font-size:20px;pointer-events:none">At Practice Field</span>
                    </div>
                    <div class="basebutton notif" style="width: 20%;margin:5px" data-notif="match">
                        <span class="basetext" style="font-size:20px;pointer-events:none">At Match</span>
                    </div>
                    <div class="basebutton notif" style="width: 20%;margin:5px" data-notif="strategy">
                        <span class="basetext" style="font-size:20px;pointer-events:none">Doing Strategy</span>
                    </div>
                    <div class="basebutton notif" style="width: 20%;margin:5px" data-notif="lunch">
                        <span class="basetext" style="font-size:20px;pointer-events:none">At Lunch</span>
                    </div>
                    <div class="basebutton notif" style="width: 20%;margin:5px" data-notif="done">
                        <span class="basetext" style="font-size:20px;pointer-events:none">Done for Day</span>
                    </div>
                </div>
                <br/>
                <div class="basebutton" style="width: 20%;margin:5px" id="statusOverlayExit">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Exit</span>
                </div>
            </div>
            <div class="container overlaybox" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;text-align:center;" data-purpose="restartConfirmation">
                <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px">Are you sure you want to restart the application?</span>
                <div class="basebutton" style="width: 20%;margin:5px;background:red" id="confirmRestart">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Restart</span>
                </div>
                <div class="basebutton exitoverlay" style="width: 20%;margin:5px">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Cancel</span>
                </div>
                <br/>
            </div>
            <div class="container overlaybox" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;text-align:center;" data-purpose="scheduleSettings">
                <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px">Schedule View Settings</span>
                <div class="basebutton exitoverlay" style="width: 20%;margin:5px">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Exit</span>
                </div>
                <br/>
            </div>
            <div class="container overlaybox" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;text-align:center;" data-purpose="techSettings">
                <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px">Extra Settings</span>
                <div class="basebutton extrasettings" style="width:20%;margin:5px">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Use Experimental Password</span>
                </div>
                <br/>
                <br/>
                <div class="basebutton exitoverlay" style="width: 20%;margin:5px">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Exit</span>
                </div>
                <br/>
            </div>
            <div class="container overlaybox" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;text-align:center;" data-purpose="teamNum">
                <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px">Set Application Team Number</span>
                <input type="text" placeholder="Team Number" id="setTeam" class="textbox basetext"/>
                <br/>
                <br/>
                <div style="display:inline-flex">
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="0">
                        <span class="basetext" style="font-size:20px;pointer-events:none">0</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="1">
                        <span class="basetext" style="font-size:20px;pointer-events:none">1</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="2">
                        <span class="basetext" style="font-size:20px;pointer-events:none">2</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="3">
                        <span class="basetext" style="font-size:20px;pointer-events:none">3</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="4">
                        <span class="basetext" style="font-size:20px;pointer-events:none">4</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="5">
                        <span class="basetext" style="font-size:20px;pointer-events:none">5</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="6">
                        <span class="basetext" style="font-size:20px;pointer-events:none">6</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="7">
                        <span class="basetext" style="font-size:20px;pointer-events:none">7</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="8">
                        <span class="basetext" style="font-size:20px;pointer-events:none">8</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="9">
                        <span class="basetext" style="font-size:20px;pointer-events:none">9</span>
                    </div>
                    <div class="basebutton teamnumberadd" style="width: 6%;margin:3px;padding:12px" data-role="x">
                        <span class="basetext" style="font-size:20px;pointer-events:none">X</span>
                    </div>
                </div>
                <br/>
                <div class="basebutton" style="width: 16%;margin-bottom:20px;margin-top:20px" id="submitTeam">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Submit</span>
                </div>
            </div>
            <div class="container overlaybox" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;text-align:center;" data-purpose="config">
                <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px">Set Configuration</span>
                <br/>
                <br/>
                <div style="display:inline-flex">
                    <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px;display:inline-flex">Event Code</span>
                    <input type="text" placeholder="Event Code" id="setEventCode" class="textbox basetext" style="display:inline-flex"/>
                </div>
                <div style="display:inline-flex">
                    <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px;display:inline-flex">IP Address</span>
                    <input type="text" placeholder="IP Address" id="ipAddress" class="textbox basetext" style="display:inline-flex" disabled/>
                </div>
                <div style="display:inline-flex">
                    <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px;display:inline-flex">Match Type</span>
                    <select class="textbox basetext" id="matchType" style="display:inline-flex">
                        <option value="Qualification">Qualification</option>
                        <option value="Playoff">Elimination</option>
                    </select>
                </div>
                <div style="display:inline-flex">
                    <span class="basetext" style="font-size:40px;color:white;display:block;margin:20px;display:inline-flex">Update Interval</span>
                    <input type="number" placeholder="Interval" id="setInterval" class="textbox basetext" style="display:inline-flex"/>
                </div>
                <br/>
                <div class="basebutton" style="width: 16%;margin-bottom:20px;margin-top:20px" id="submitConfig">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Save</span>
                </div>
            </div>
        </div>
        <div class="backgroundanim" style="position: absolute;z-index:3;top:0;left:0;width:100%;height:100%;transition:all 0.5s ease-in-out;display:none;opacity:0" id="lockScreen">
            <div style="position: absolute;top:20%;left:50%;transform:translateX(-50%);">
                <div class="innercontainer" style="width:60vw;height:60vw;border-radius:60vw;transition:0.5s all ease-in-out;margin-bottom:100px;" id="unlock">
                    <img src="lock.svg" style="width: 60%;margin-top:20%;pointer-events:none"/>
                </div>
                <div style="width:60vw;height:60vw;margin-bottom:100px;display:none;opacity:0" id="enterCode">
                    <div class="innercontainer keypad" style="width:20vw;height:20vw;border-radius:20vw;transition:0.3s all ease-in-out;display:inline-block;margin:5px" data-code="1" data-color="#3679ff">
                        <img src="images/cloud.svg" style="width: 60%;margin-top:20%;pointer-events:none"/>
                    </div>
                    <div class="innercontainer keypad" style="width:20vw;height:20vw;border-radius:20vw;transition:0.3s all ease-in-out;display:inline-block;margin:5px" data-code="2" data-color="#3679ff">
                        <img src="images/trophy.svg" style="width: 60%;margin-top:20%;pointer-events:none"/>
                    </div>
                    <div class="innercontainer keypad" style="width:20vw;height:20vw;border-radius:20vw;transition:0.3s all ease-in-out;display:inline-block;margin:5px" data-code="3" data-color="#3679ff">
                        <img src="images/water.svg" style="width: 60%;margin-top:20%;pointer-events:none"/>
                    </div>
                    <div class="innercontainer keypad" style="width:20vw;height:20vw;border-radius:20vw;transition:0.3s all ease-in-out;display:inline-block;margin:5px" data-code="4" data-color="#3679ff">
                        <img src="images/bolt.svg" style="width: 60%;margin-top:20%;pointer-events:none"/>
                    </div>
                </div>
                <br/>
                <span class="basetext" style="font-size:80px;pointer-events:none;font-weight:600">Pit Crew</span>
            </div>
        </div>
        <div class="container" id="nextUp">
            <div style="display: flex;justify-content:space-around;margin-top:40px">
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Our Next Match</span>
                        <div class="innercontainer" style="width:160px;height:80px;display:block;text-align:center">
                            <span class="basetext" style="font-size:40px;font-weight:600;display:block" id="nextMatch">20</span>
                            <span class="basetext" style="font-size:20px;font-weight:600;display:block" id="nextMatchD">Qualification</span>
                            
                        </div>
                    </div>
                   
                </div>
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Match Gap</span>
                        <div class="innercontainer" style="width:200px;height:80px;display:block;text-align:center">
                            <span class="basetext" style="font-size:40px;font-weight:600;display:block" id="queueTime">6</span>
                            <span class="basetext" style="font-size:20px;font-weight:600;display:block" id="lastMatch">from 20...</span>
                        </div>
                    </div>
                   
                </div>
                <div style="display:inline-flex">
                    <div style="display:block;text-align:left">
                        <span class="basetext" style="display:block;font-size:14px;margin-bottom:5px;margin-left:10px">Bumpers</span>
                        <div class="innercontainer red" style="width:160px;height:80px;display:block;text-align:center" id="bumpersTextContainer">
                            <span class="basetext" style="font-size:60px;font-weight:600" id="bumpersText">Red</span>
                        </div>
                    </div>
                   
                </div>
            </div>
            <div style="display: flex;justify-content:center;margin-top:40px;margin-bottom:40px" id="teamsPresent">
                <div style="display:inline-flex">
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">254</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer red" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">862</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">1023</span>
                        </div>
                        
                    </div>
                    <div style="border-left:2px solid white;height:45px;margin:5px;margin-top:5px;border-radius:2px"></div>
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">33</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">118</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">494</span>
                        </div>
                        
                    </div>
                   
                </div>
            </div>
            <div class="basebutton" style="width: 20%;margin-bottom:20px" id="prevMatchC">
                <span class="basetext" style="font-size:20px;pointer-events:none">Previous Match</span>
            </div>
            <div class="basebutton" style="width: 20%;margin-bottom:20px" id="nextMatchC">
                <span class="basetext" style="font-size:20px;pointer-events:none">Next Match</span>
            </div>
        </div>
        <div class="container" id="container_checklist">
            <div>
                <h1 class="basetext" style="display:inline-block" id="checklistHeader">Pits Checklist</h1>
                <div class="basebutton checklist" style="width: 8%;margin:5px;display:inline-block;margin-left:25px;" data-role="reset">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Reset</span>
                </div>
            </div>
            <div id="rolechecklist" style="width:90%;display:inline-block;margin-bottom:20px">
                <div class="basebutton checklist" style="width: 17%;margin:5px" data-role="Electrical">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Electrical</span>
                </div>
                <div class="basebutton checklist" style="width: 8%;margin:5px" data-role="Fab 1">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Fab 1</span>
                </div>
                <div class="basebutton checklist" style="width: 8%;margin:5px" data-role="Fab 2">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Fab 2</span>
                </div>
                <div class="basebutton checklist" style="width: 17%;margin:5px" data-role="Programming">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Programming</span>
                </div>
                <div class="basebutton checklist" style="width: 17%;margin:5px" data-role="Technician">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Technician</span>
                </div>
            </div>
        </div>

        <div class="container" style="display:none" id="container_settingsMenu">
            <div>
                <h1 class="basetext" style="display:inline-block">Secret Settings</h1>
            </div>

            <div style="width:90%;display:inline-block;margin-bottom:20px">
                <div class="basebutton secSettings" style="width: 25%;margin:5px;display:none" setting="showScheduleSettings">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Schedule Settings</span>
                </div>
                <div class="basebutton secSettings" style="width: 25%;margin:5px" setting="showTechSettings">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Extra Settings</span>
                </div>
                </br>
                <div class="basebutton secSettings" style="width: 25%;margin:5px" setting="gitPull">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Pull Git</span>
                </div>
                <div class="basebutton secSettings" style="width: 25%;margin:5px" setting="restart">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Restart Node</span>
                </div>
                </br>
                <div class="basebutton" style="width: 25%;margin:5px" id="showConfig"> <!-- TODO: move into secSettings switch -->
                    <span class="basetext" style="font-size:20px;pointer-events:none">Set Config</span>
                </div>
                <div class="basebutton" style="width: 25%;margin:5px" id="showSetTeam">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Set Team</span>
                </div>
            </div>

        </div>

        <div class="container">
            <div>
                <h1 class="basetext" style="display:inline-block">Pit Controller</h1>
            </div>

            <div style="width:90%;display:inline-block;margin-bottom:20px">
                <div class="basebutton" style="width: 25%;margin:5px" id="lockTech">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Lock Inside</span>
                </div>
                <div class="basebutton" style="width: 25%;margin:5px" id="lockPits">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Lock Outside</span>
                </div>
                <div class="basebutton" style="width: 25%;margin:5px" id="statusDropdown">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Display Status</span>
                </div>
                </br>
                <div class="basebutton" style="width: 25%;margin:5px" id="showStream">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Show Stream</span>
                </div>
                <div class="basebutton" style="width: 25%;margin:5px;display:none" id="syncStream">
                    <span class="basetext" style="font-size:20px;pointer-events:none">Sync Stream</span>
                </div>
            </div> 
        </div>
    </div>
    <div class="notificationbox innercontainer blue" id="notificationBox">
        <h1 class="basetext" id="notificationText">Currently in Queue</h1>
    </div>
    <div class="basebutton" style="position:absolute;bottom:-1;left:0;background:transparent;color:transparent;height:55px;width:50px" id="secret">
        <span class="basetext" style="font-size:20px;pointer-events:none;color:transparent">SECRET</span>
    </div>

    <script src="socket.io.js"></script>
    <script>
        const socket = io("ws://localhost:3001", {
            cors: {
                origin: "http://localhost",
                methods: ["GET", "POST"]
              }
        });

        socket.on('disconnect', function(){
            showNotif("Disconnected from Server", "reddim");
        });

        socket.on('connect', function(){
            hideNotif();
            socket.emit("getTeam");
            socket.emit('getIp');
            console.log("Successfully connected to server");
        });

        var timeToReset = 120;
        var startTime = new Date();
        // 0 = Not Ready, 1 = In Queue, 2 = Ready, 3 = In Match
        var matchStatus = 0;
        var notificationOut = false;
        var lastEventCode = "";
        var teamNum = undefined;
        var allMatches = [];
        var roles = {
            "Electrical" : false,
            "Fab 1" : false,
            "Fab 2" : false,
            "Programming" : false,
            "Technician" : false
        }

        var secretButtonPressed = false;

        var matchData = {
            "matchNumber" : undefined,
            "status" : undefined,
            "rankingPoints" : [false,false]
        }


        function showNotif(content, color){
            

            if(notificationOut){
                hideNotif();
                setTimeout(function(){
                    notificationOut = false;
                    showNotif(content, color);
                }, 500);
                return;
            }

            if(color == "red"){
                document.getElementById("notificationBox").style.backgroundColor = "#ff3636";
            }else if(color == "reddim"){
                document.getElementById("notificationBox").style.backgroundColor = "#a12222";
            }else if(color == "blue"){
                document.getElementById("notificationBox").style.backgroundColor = "#3679ff";
            }else if(color == "bluedim"){
                document.getElementById("notificationBox").style.backgroundColor = "#2450a6";
            }else if(color == "success"){
                document.getElementById("notificationBox").style.backgroundColor = "#1fcc87";
            }else if(color == "successdim"){
                document.getElementById("notificationBox").style.backgroundColor = "#199e69";
            }
            document.getElementById("notificationBox").style.bottom = "20px";
            document.getElementById("notificationText").innerHTML = content;
            document.getElementById("notificationBox").classList.add("notificationanim");
            notificationOut = true;
            setTimeout(function(){
                document.getElementById("notificationBox").classList.remove("notificationanim");
            }, 2000);
        }
        function hideNotif(){
            document.getElementById("notificationBox").style.bottom = "-200px";
            notificationOut = false;
        }


        function hideOverlay(){
            document.getElementById("totalOverlay").style.opacity = "0";
            setTimeout(function(){
                document.getElementById("totalOverlay").style.display = "none";
            }, 600);
        }

        function showOverlay(overlayBox){
            Array.from(document.getElementsByClassName("overlaybox")).forEach(function(element){
                element.style.display = "none";
                if(element.dataset.purpose == overlayBox){
                    element.style.display = "block";
                }
            });
            document.getElementById("totalOverlay").style.display = "";
            setTimeout(function(){
                document.getElementById("totalOverlay").style.opacity = "1";
            }, 10);
        }


        document.getElementById("submitMatch").addEventListener("click", function(){
            hideOverlay();
        });


        Array.from(document.getElementsByClassName("matchdataitem")).forEach(function(element){
            element.addEventListener("click", function(evt){
                var category = evt.srcElement.dataset.category;

                if(category == "status"){
                    matchData["status"] = evt.srcElement.dataset.value;
                    evt.srcElement.classList.add("blue");
                    Array.from(document.getElementsByClassName("matchdataitem")).forEach(function(element){
                        if(element.dataset.category == "status" && element.dataset.value != matchData["status"]){
                            try{
                                element.classList.remove("blue");
                            }catch(e){

                            }
                        }
                    });
                }else if(category == "rankingPoints"){
                    var value = parseInt(evt.srcElement.dataset.value);
                    if(evt.srcElement.classList.contains("circlebuttonselected")){
                        evt.srcElement.classList.remove("circlebuttonselected");
                        evt.srcElement.style.backgroundColor = "";
                        matchData["rankingPoints"][value] = false;
                    }else{

                        evt.srcElement.classList.add("circlebuttonselected");
                        //roles[evt.srcElement.getAttribute("data-role")] = true;
                        matchData["rankingPoints"][value] = true;
                        setTimeout(function(){
                            evt.srcElement.style.backgroundColor = "#3679ff";
                        }, 100);
                    }
                }
            });
        });

        Array.from(document.getElementsByClassName("checklist")).forEach(function(element){
            
            element.addEventListener("click", function(evt){
                if(evt.srcElement.dataset.role == "reset"){
                    Array.from(document.getElementsByClassName("checklist")).forEach(function(element){
                        element.classList.remove("checklistselected");
                        element.style.backgroundColor = "";
                        
                        
                    });
                    hideNotif();
                    roles = {
                        "Electrical" : false,
                        "Fab 1" : false,
                        "Fab 2" : false,
                        "Programming" : false,
                        "Technician" : false
                    };
                }else{
                    if(evt.srcElement.classList.contains("checklistselected")){
                        evt.srcElement.classList.remove("checklistselected");
                        evt.srcElement.style.backgroundColor = "";
                        roles[evt.srcElement.getAttribute("data-role")] = false;
                        hideNotif();
                    }else{
                        evt.srcElement.classList.add("checklistselected");
                        roles[evt.srcElement.getAttribute("data-role")] = true;
    
                        if(roles["Electrical"] && roles["Fab 1"] && roles["Fab 2"] && roles["Programming"] && roles["Technician"]){
                            showNotif("Ready to Match!", "success");
                            matchStatus = 2;
                        }
    
                        setTimeout(function(){
                            evt.srcElement.style.backgroundColor = "#3679ff";
                        }, 100);
                    }
                }
                
                
            });
        
        });

        var fieldCurrent = undefined;        

        function updateMatch(i){
            var currentMatch = allMatches[i];
            var lastMatch = i > 0 ? allMatches[i-1]["n"] : 1;
            if(currentMatch == undefined){
                document.getElementById("queueTime").innerHTML = "---";
                
                document.getElementById("lastMatch").innerHTML = "No Match on Field";
                document.getElementById("nextMatch").innerHTML = "---";
                document.getElementById("nextMatchD").innerHTML = "Non-Existent";
                document.getElementById("checklistHeader").innerHTML = "Pits Checklist";
                document.getElementById("bumpersText").innerHTML = "---";
                document.getElementById("bumpersTextContainer").style.backgroundColor = "";
                document.getElementById("teamsPresent").innerHTML = `<div style="display:inline-flex">
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">---</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">---</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer reddim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">---</span>
                        </div>
                        
                    </div>
                    <div style="border-left:2px solid white;height:45px;margin:5px;margin-top:5px;border-radius:2px"></div>
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">---</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">---</span>
                        </div>
                        
                    </div>
                    <div style="display:block">
                        <div class="innercontainer bluedim" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                            <span class="basetext" style="font-size:20px;font-weight:600">---</span>
                        </div>
                        
                    </div>
                
                </div>`
            }else{
                if(fieldMatch == 0){
                    document.getElementById("queueTime").innerHTML = (currentMatch["n"]-lastMatch) + "*";
                }else{
                    document.getElementById("queueTime").innerHTML = (currentMatch["n"]-lastMatch) + "";
                    if((currentMatch["n"]-fieldMatch-2) < 0){
                        // showNotif("Warning: Nearing Our Match Quickly!", "red")
                    }
                    else if((currentMatch["n"]-fieldMatch-2) <= 0){
                        showNotif("Let's go, we are in QUEUE!", "blue")
                    }
                }
                
            
            if(fieldMatch == 0){
                document.getElementById("lastMatch").innerHTML = "No Match on Field";
            }else{
                document.getElementById("lastMatch").innerHTML = "Match on Field: " + fieldMatch;
            }
            document.getElementById("nextMatch").innerHTML = currentMatch['n'];
            document.getElementById("nextMatchD").innerHTML = currentMatch['d'].split(" ")[0];
            if(currentMatch['d'].split(" ")[0] != "Qualification"){
                document.getElementById("nextMatch").innerHTML = currentMatch['d'].split(" ")[currentMatch['d'].split(" ").length-1];
            }
            document.getElementById("checklistHeader").innerHTML = "Match " + currentMatch['n'] + "'s Checklist";
            document.getElementById("bumpersText").innerHTML = currentMatch['teams'].indexOf(teamNum) <= 2 ? "Red" : "Blue";
            document.getElementById("bumpersTextContainer").style.backgroundColor = currentMatch['teams'].indexOf(teamNum) <= 2 ? "#ff3636" : "#3679ff";
            document.getElementById("teamsPresent").innerHTML = `<div style="display:inline-flex">
                <div style="display:block">
                    <div class="innercontainer ${currentMatch['teams'][0] == teamNum ? "red" : "reddim"}" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                        <span class="basetext" style="font-size:20px;font-weight:600">${currentMatch['teams'][0]}</span>
                    </div>
                    
                </div>
                <div style="display:block">
                    <div class="innercontainer ${currentMatch['teams'][1] == teamNum ? "red" : "reddim"}" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                        <span class="basetext" style="font-size:20px;font-weight:600">${currentMatch['teams'][1]}</span>
                    </div>
                    
                </div>
                <div style="display:block">
                    <div class="innercontainer ${currentMatch['teams'][2] == teamNum ? "red" : "reddim"}" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                        <span class="basetext" style="font-size:20px;font-weight:600">${currentMatch['teams'][2]}</span>
                    </div>
                    
                </div>
                <div style="border-left:2px solid white;height:45px;margin:5px;margin-top:5px;border-radius:2px"></div>
                <div style="display:block">
                    <div class="innercontainer ${currentMatch['teams'][3] == teamNum ? "blue" : "bluedim"}" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                        <span class="basetext" style="font-size:20px;font-weight:600">${currentMatch['teams'][3]}</span>
                    </div>
                    
                </div>
                <div style="display:block">
                    <div class="innercontainer ${currentMatch['teams'][4] == teamNum ? "blue" : "bluedim"}" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                        <span class="basetext" style="font-size:20px;font-weight:600">${currentMatch['teams'][4]}</span>
                    </div>
                    
                </div>
                <div style="display:block">
                    <div class="innercontainer ${currentMatch['teams'][5] == teamNum ? "blue" : "bluedim"}" style="width:60px;height:25px;display:block;text-align:center;margin:5px;padding:10px">
                        <span class="basetext" style="font-size:20px;font-weight:600">${currentMatch['teams'][5]}</span>
                    </div>
                    
                </div>
               
            </div>`
            }
            
        }

        var codevalues = [];
        var correct = "1342"
        Array.from(document.getElementsByClassName("keypad")).forEach(function(element){
            element.addEventListener("click", function(evt){
                var val = evt.srcElement.dataset.code;
                if(codevalues.includes(val)){
                    evt.srcElement.classList.add("turnbounceanim");
                    
                    setTimeout(function(){
                        evt.srcElement.classList.remove("turnbounceanim")
                        
                    }, 650);
                }else{
                    evt.srcElement.style.backgroundColor = evt.srcElement.dataset.color;
                    evt.srcElement.classList.add("circlebuttonselected2");
                    setTimeout(function(){
                        evt.srcElement.classList.remove("circlebuttonselected2");
                    }, 450);
                    codevalues.push(val);
                    if(codevalues.length >= 4){
                        setTimeout(function(){
                            var gen = codevalues.join("");
                            if(correct == gen){
                                Array.from(document.getElementsByClassName("keypad")).forEach(function(element){
                                    element.style.backgroundColor = "#1fcc87";
                                    element.classList.add("circlebuttonselected2");
                                });
                                setTimeout(function(){
                                    Array.from(document.getElementsByClassName("keypad")).forEach(function(element){
                                        element.style.backgroundColor = "";
                                        element.classList.remove("circlebuttonselected2")
                                    });
                                    codevalues = [];
                                    document.getElementById("lockScreen").style.opacity = "0";
                                    setTimeout(function(){
                                        evt.srcElement.classList.remove("circlebuttonselected2");
                                    }, 450);
                                    setTimeout(function(){
                                        document.getElementById("lockScreen").style.display = "none";
                                    },550)
                                }, 600);
                            }else{
                                Array.from(document.getElementsByClassName("keypad")).forEach(function(element){
                                    element.style.backgroundColor = "#ff3636";
                                    element.classList.add("turnbounceanim");
                                });
                                setTimeout(function(){
                                    Array.from(document.getElementsByClassName("keypad")).forEach(function(element){
                                        element.style.backgroundColor = "";
                                        element.classList.remove("turnbounceanim");
                                    });
                                    codevalues = [];
                                }, 800);
                            }
                        },800);
                        
                    }
                }
                
                
            });
        });
        var offset = 1;
        var fieldMatch = 0;
        socket.on("matches", function(data){

            var matches = data["docs"];
            fieldMatch = data["currentMatch"]

            //console.log(matches[1].teams.includes(teamNum));
            allMatches = matches.filter(m => m.teams.includes(teamNum));
            
            var currentMatch = undefined;
            allMatches.sort((a,b) => (a.n > b.n) ? 1 : ((b.n > a.n) ? -1 : 0))
            matches.sort((a,b) => (a.n > b.n) ? 1 : ((b.n > a.n) ? -1 : 0))
            allMatches.forEach(function(match){
                if(document.getElementById("setEventCode").value != match["comp"]){
                    offset = 1;
                }
                document.getElementById("setEventCode").value = match["comp"];

                
                
                if(match['status'] == "pending" && currentMatch == undefined && match['teams'].includes(teamNum)){
                    currentMatch = match;
                }
            });

            
            matchIndex = allMatches.indexOf(currentMatch);
            
            updateMatch(matchIndex + offset);

        });

        document.getElementById("prevMatchC").addEventListener("click", function(evt){
            evt.srcElement.classList.add("checklistselected");
            evt.srcElement.style.backgroundColor = "#3679ff";
            setTimeout(function(){
                evt.srcElement.classList.remove("checklistselected");
                evt.srcElement.style.backgroundColor = "";
            }, 550);
            offset--;
                updateMatch(matchIndex+offset);
            roles = {
                "Electrical" : false,
                "Fab 1" : false,
                "Fab 2" : false,
                "Programming" : false,
                "Technician" : false
            }
            hideOverlay();
        });
        document.getElementById("nextMatchC").addEventListener("click", function(evt){
            evt.srcElement.classList.add("checklistselected");
            evt.srcElement.style.backgroundColor = "#3679ff";
            setTimeout(function(){
                evt.srcElement.classList.remove("checklistselected");
                evt.srcElement.style.backgroundColor = "";
            }, 550);
            offset++;
                updateMatch(matchIndex+offset);
            roles = {
                "Electrical" : false,
                "Fab 1" : false,
                "Fab 2" : false,
                "Programming" : false,
                "Technician" : false
            }
            hideOverlay();
        });

        socket.on("team", function(val){
            teamNum = parseInt(val);
            
            if(teamNum == undefined){
                socket.emit("setTeam", 862);
                document.getElementById("setTeam").value = "862";
                
            }else{
                hideOverlay();
                document.getElementById("setTeam").value = teamNum.toString();
                socket.emit("getMatches");  
            }
            
        });

        document.getElementById("showSetTeam").addEventListener("click", function(){
            showOverlay("teamNum");
        });
        document.getElementById("submitTeam").addEventListener("click", function(){
            socket.emit("setTeam", parseInt(document.getElementById("setTeam").value));
            hideOverlay();

        });
        document.getElementById("submitConfig").addEventListener("click", function(){
            // calc new config
            timeToReset = parseInt(document.getElementById("setInterval").value);
            socket.emit("setConfig", document.getElementById("setEventCode").value, document.getElementById("matchType").value);
            hideOverlay();

        });

        Array.from(document.getElementsByClassName("teamnumberadd")).forEach(function(element){
            element.addEventListener("click", function(evt){
                evt.srcElement.classList.add("checklistselected");

                
                var num = evt.srcElement.dataset.role;
                if(num == "x"){
                    document.getElementById("setTeam").value = "";
                }else if(document.getElementById("setTeam").value.toString().length < 4){
                    document.getElementById("setTeam").value = document.getElementById("setTeam").value.toString() + num;
                }
                

                setTimeout(function(){
                    evt.srcElement.style.backgroundColor = "#3679ff";
                }, 100);

                setTimeout(function(){
                    evt.srcElement.classList.remove("checklistselected");
                    evt.srcElement.style.backgroundColor = "";
                }, 600);
                
                
            });
        
        });

        Array.from(document.getElementsByClassName("secSettings")).forEach(function(element){
            element.addEventListener("click", function(evt){
                const setting = evt.srcElement.getAttribute("setting");
                switch (setting) {
                    case "gitPull":
                        // disable button to let git pull
                        evt.srcElement.style.backgroundColor = "#2b2b2b";
                        evt.srcElement.style.pointerEvents = "none";
                        evt.srcElement.innerHTML = '<span class="basetext" style="font-size:20px;pointer-events:none">Pullling...</span>';
                        socket.emit("gitPull");
                        setTimeout(function(){
                            evt.srcElement.style.backgroundColor = "";
                            evt.srcElement.style.pointerEvents = "";
                            evt.srcElement.innerHTML = '<span class="basetext" style="font-size:20px;pointer-events:none">Pulled!</span>';
                        }, 2000);
                        setTimeout(function(){
                            evt.srcElement.innerHTML = '<span class="basetext" style="font-size:20px;pointer-events:none">Pull Git</span>';
                        }, 3000);
                        break;
                    case "restart":
                        showOverlay("restartConfirmation");
                        break;
                    case "showScheduleSettings":
                        showOverlay("scheduleSettings");
                        break;
                    case "showTechSettings":
                        showOverlay("techSettings");
                        break;
                    default:
                        console.log("Error: SecretSetting not registered");
                        break;
                }
            });
        });
        
        document.getElementById('lockPits').addEventListener("click", function(evt){
            if(evt.srcElement.classList.contains("checklistselected")){
                evt.srcElement.classList.remove("checklistselected");
                evt.srcElement.style.backgroundColor = "";
                pitslocked = false;
            }else{
                evt.srcElement.classList.add("checklistselected");
                evt.srcElement.style.backgroundColor = "#3679ff";
                pitslocked = true;
            }
            socket.emit("changeLock", pitslocked);
        });

        document.getElementById("lockTech").addEventListener("click", function(){
            document.getElementById("unlock").style.display = "";
            document.getElementById("unlock").style.opacity = "1";
            document.getElementById("enterCode").style.display = "none";
            document.getElementById("enterCode").style.opacity = "0";
            document.getElementById("lockScreen").style.display = "";
            setTimeout(function(){
                document.getElementById("lockScreen").style.opacity = "1";
            }, 10);
        })

        document.getElementById("showConfig").addEventListener("click", function(){
            showOverlay("config")
        })

        document.getElementById("secret").addEventListener("click", function(evt){
            secretButtonPressed = !secretButtonPressed;
            document.getElementById("container_checklist").style.display = secretButtonPressed ? "none" : "block";
            document.getElementById("container_settingsMenu").style.display = secretButtonPressed ? "block" : "none";
        });

        document.getElementById("statusDropdown").addEventListener("click", function(evt){
            showOverlay("status");
        });

        Array.from(document.getElementsByClassName("exitoverlay")).forEach(function(element){
            element.addEventListener("click", function(evt){
                hideOverlay();
            });
        });

        document.getElementById("confirmRestart").addEventListener("click", function(evt) {
            socket.emit("restartApp");
        });

        document.getElementById("showStream").addEventListener("click", function(evt){
            if(evt.srcElement.classList.contains("checklistselected")){
                evt.srcElement.classList.remove("checklistselected");
                evt.srcElement.style.backgroundColor = "";
                socket.emit("showScheduleView");
                document.getElementById("syncStream").style.display = "none";
            } else{
                evt.srcElement.classList.add("checklistselected");
                evt.srcElement.style.backgroundColor = "#3679ff";
                socket.emit("switchStreamView");
                document.getElementById("syncStream").style.display = "inline-block";
            }
        })

        document.getElementById("syncStream").addEventListener("click", function(evt){
            evt.srcElement.classList.add("checklistselected");
            evt.srcElement.style.backgroundColor = "#3679ff";
            setTimeout(function(){
                evt.srcElement.classList.remove("checklistselected");
                evt.srcElement.style.backgroundColor = "";
            }, 350);
            socket.emit("reloadStream");
        })

        document.getElementById("unlock").addEventListener("click", function(evt){
            if(evt.srcElement.classList.contains("turnbounceanim")){
                // UNLOCK SCREEN
                evt.srcElement.classList.remove("turnbounceanim");
                evt.srcElement.classList.add("circlebuttonselected2");
                setTimeout(function(){
                    evt.srcElement.classList.remove("circlebuttonselected2");
                }, 450);


                // now show the code
                document.getElementById("unlock").style.opacity = "0";
                setTimeout(function(){
                    document.getElementById("unlock").style.display = "none";
                    document.getElementById("enterCode").style.display = "";
                    setTimeout(function(){
                        document.getElementById("enterCode").style.opacity = "1";
                    }, 10);
                }, 600);
            }else{
                evt.srcElement.classList.add("turnbounceanim");
                setTimeout(function(){
                    evt.srcElement.classList.remove("turnbounceanim");
                }, 650);
            }
        });

        var lastNotif = undefined;
        Array.from(document.getElementsByClassName("notif")).forEach(function(element){
            element.addEventListener("click", function(evt){
                
                if(evt.srcElement.dataset.notif == "reset"){
                    

                }else{
                    if(evt.srcElement.classList.contains("checklistselected")){
                        socket.emit("notif", "cancel");
                        evt.srcElement.classList.remove("checklistselected");
                        evt.srcElement.style.backgroundColor = "";
                    }else{
    
                        Array.from(document.getElementsByClassName("notif")).forEach(function(element){
                            if(element.dataset.notif != evt.srcElement.dataset.notif){
                                element.classList.remove("checklistselected");
                                element.style.backgroundColor = "";
                            }
                            
                        });
    
    
                        socket.emit("notif", evt.srcElement.dataset.notif);
                        if(lastNotif != undefined){
                            evt.srcElement.classList.remove("checklistselected");
                            evt.srcElement.style.backgroundColor = "";  
                        }
                        evt.srcElement.classList.add("checklistselected");
                        setTimeout(function(){
                            evt.srcElement.style.backgroundColor = "#3679ff";
                        }, 100);
                    }
                }
                
                
            });
        
        });

        socket.on('ip', (ip) => {
            document.getElementById("ipAddress").value = ip;
        });
        document.getElementById("setInterval").value = 120;
        setInterval(function(){
            var timeBetween = (new Date().getTime() - startTime.getTime()) / 1000;
            if(timeBetween > timeToReset){
                socket.emit("getMatches_API")
                startTime = new Date();
            }
            
        },500)
        
        socket.on("gitCommandOutput", (stdout) => {
            showNotif(stdout, "bluedim");
        });
        
    </script>
    
</body>
